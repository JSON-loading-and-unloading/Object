# 14 일관성 있는 협력

- 객체는 협력을 위해 존재한다. 협력은 객체가 존재하는 이유와 문맥을 제공한다.
- 객체지향 설계의 목표는 적절한 책임을 수행하는 객체들의 협력을 기반으로 결합도가 낮고 재사용 가능한 코드 구조를 창조하는 것이다.
- 객체지향 패러다임 장점은 설계를 재사용할 수 있다는 것이다.
- 유사한 기능을 구현하기 위해 유사한 협력 패턴을 사용하라.

## 01 핸드폰 과금 시스템 변경하기

### 현재 설계의 문제점

- 현재 구현의 가장 큰 문제점은 이 클래스들이 유사한 문제를 해결하고 있음에도 불구하고 설계 일관성이 없다는 것이다.
- 설계의 비일관성은 두 가지 상황에서 발목 잡는다.
- 새로운 구현을 추가해야 하는 상황
- 기존의 구현을 이해해야 하는 상황
- 결론적으로 유사한 기능을 서로 다른 방식으로 구현해서는 안 된다. 유사한 기능은 유사한 방식으로 구현해야 한다.

## 02 설계에 일관성 부여하기

- 일관성 있는 설계를 위해서는 다양한 설계 경험을 익혀야 한다. 또한 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥 안에서 적용해 봐야 한다.
- 협력을 일관성 있게 만들기 위해 다음과 같은 기본 지침을 따르는 것이 도움이 될 것이다.

### 조건 로직 대 객체 탐색

- 영화 예매 시스템 설계
- 협력을 일관성 있게 만들기 위해선 다음 지침들을 따라야 한다.

### 캡슐화 다시 살펴보기

- 캡슐화란 변하는 어떤 것이든 감추는 것이다.
- 캡슐화는 다음과 같이 다양한 종류가 있다.
- 캡슐화란 단지 데이터 은닉을 의마하는 것이 아니다. 코드 수정으로 인한 파급효과를 제어할 수 있는 모든 기법이 캡술화의 일종이다.
- 변경을 캡슐화하기 위해 서브타입 캡슐화와 객체 캡슐화를 조합할 수 있다.

## 03 일관성 있는 기본 정책 구현하기

### 변경 분리하기

- 시간대별, 요일별, 구간별 방식은 기본 정책을 구성하는 방식이 유사하다
- 시간대별, 요일별, 구간별 방식의 차이점은 각 기본 정책별로 요금을 계산하는 적용 조건의 형식이 다르다.
- 변하지 않는 ‘규칙’으로부터 변하는 ‘적용조건’을 분리해야 한다.

### 변경 캡슐화하기

- 협력을 일관성 있게 만들기 위해서는 변경을 캡슐화해서 파급효과를 줄여야 한다.
- 변경을 캡슐화하는 가장 좋은 방법은 변하지 않는 부분으로부터 변하는 부분을 분리하는 것이다.
- 변하지 않는 ‘규칙’에서 변하는 ‘적용조건’을 분리해서 추상화해야 한다.

### 구체적인 협력 구현하기

- 변경을 캡슐화해서 협력을 일관성 있게 만들 얻을 수 있는 장점
- 유사한 기능에 대해 유사한 협력 패턴을 적용하는 것은 개념적 무결성(일관성)을 유지할 수 있는 가장 효과적인 방법이다.

### 협력 패턴에 맞추기

- 기존의 협력 방식에서 벗어나는 새로운 기능이 생기는 경우 또 다른 협력 패턴을 만드는 것보다 조금은 이상한 구조를 낳더라도 전체적으로 일관성을 유지하는 설계를 선택하는 것이 좋다.

### 패턴을 찾아라

- 일관성 있는 협력의 핵심은 변경을 분리하고 캡슐화하는 것이다.
- 변경을 캡슐화하는 방법이 협력에 참여하는 객체들의 역할과 책임을 결정하고 이렇게 결정된 협력이 코드의 구조를 결정한다.
- 애플리케이션에서 유사한 기능에 대한 변경이 지속적으로 발생하고 있다면 변경을 캡슐화할 수 있는 적절한 추상화를 찾은 후, 이 추상화에 변하지 않는 공통적인 책임을 할당해야 한다.
- 현재의 구조가 변경을 캡슐화하기에 적합하지 않다면 코드를 수정하지 않고도 원하는 변경을 수용할 수 있도록 협력과 코드를 리팩터링해야 한다.